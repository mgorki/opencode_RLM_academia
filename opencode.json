{
  "$schema": "https://opencode.ai/config.json",
  "theme": "tokyonight",
  "autoupdate": true,
  "share": "manual",
  "default_agent": "research-write",
  "compaction": {
    "auto": true,
    "prune": true
  },
  "watcher": {
    "ignore": [
      "node_modules/**",
      ".git/**",
      ".opencode/rlm_state/**"
    ]
  },
  "permission": {
    "edit": "allow",
    "bash": "allow",
    "webfetch": "allow",
    "skill": {
      "*": "allow"
    }
  },
  "agent": {
    "research-write": {
      "description": "Primary scientific research and writing agent — analyses the loaded PDF corpus and produces LaTeX/BibTeX academic writing",
      "mode": "primary",
      "prompt": "{file:./prompts/research-write.md}",
      "tools": {
        "write": true,
        "edit": true,
        "bash": true,
        "read": true,
        "grep": true,
        "glob": true,
        "webfetch": true,
        "skill": true
      },
      "permission": {
        "bash": {
          "*": "allow",
          "rm -rf /*": "deny",
          "rm -rf /": "deny"
        }
      }
    },
    "research-read": {
      "description": "Read-only literature analysis agent — safe corpus exploration, theme mapping, and gap analysis without producing drafts",
      "mode": "primary",
      "prompt": "{file:./prompts/research-read.md}",
      "temperature": 0.1,
      "tools": {
        "write": false,
        "edit": false,
        "bash": true,
        "read": true,
        "grep": true,
        "glob": true,
        "webfetch": false,
        "skill": true
      },
      "permission": {
        "bash": {
          "*": "ask",
          "python *": "allow",
          "cat *": "allow",
          "grep *": "allow"
        }
      }
    },
    "rlm-subcall": {
      "description": "RLM sub-LLM for chunk-level paper analysis. Given a chunk of PDF text and a query, extracts claims, evidence, and metadata, returning structured JSON. Never fabricates citations.",
      "mode": "subagent",
      "temperature": 0.1,
      "tools": {
        "read": true,
        "write": false,
        "edit": false,
        "bash": false,
        "webfetch": false
      }
    },
    "paper-analyzer": {
      "description": "Deep single-paper analysis subagent — extracts metadata, research questions, methodology, findings, and references from a given paper",
      "mode": "subagent",
      "prompt": "{file:./prompts/paper-analyzer.md}",
      "temperature": 0.1,
      "tools": {
        "read": true,
        "write": false,
        "edit": false,
        "bash": false,
        "webfetch": false
      }
    }
  },
  "command": {
    "rlm": {
      "description": "Run RLM workflow for large corpus analysis (load all PDFs and answer a research question)",
      "agent": "research-write",
      "template": "Process the scientific PDF corpus using the RLM workflow.\n\nArguments: $ARGUMENTS\n\n⚠️  YOU (the root agent) must execute all REPL steps below directly via bash.\nDo NOT spawn a generic subagent or Task for these steps — that bypasses the REPL.\nOnly delegate to @rlm-subcall when passing a chunk *file path* for content extraction.\n\nStep 1 — Load the corpus (skip if already loaded; it resumes automatically):\n```\npython .opencode/skills/rlm/scripts/rlm_repl.py load-corpus ./context/\n```\n\nStep 2 — Orient yourself:\n```\npython .opencode/skills/rlm/scripts/rlm_repl.py status\npython .opencode/skills/rlm/scripts/rlm_repl.py exec -c \"print(list_papers())\"\n```\n\nStep 3 — Find relevant papers for the query:\n```\npython .opencode/skills/rlm/scripts/rlm_repl.py exec -c \"print(find_papers('KEYWORD'))\"\npython .opencode/skills/rlm/scripts/rlm_repl.py exec -c \"print(cite('Author Year'))\"\n```\n\nStep 4 — For broad queries, use pre-written per-paper chunk files:\n  Chunks are written to .opencode/rlm_state/chunks/ during load-corpus.\n  Each file is named <bibtex_key>_chunk_NNNN.txt\n  List them: python .opencode/skills/rlm/scripts/rlm_repl.py exec -c \"import os; print(sorted(os.listdir('.opencode/rlm_state/chunks'))[:20])\"\n  Then pass each relevant chunk path + the query to @rlm-subcall.\n\nStep 5 — Synthesise subagent JSON outputs into a final answer with verified citations."
    },
    "research": {
      "template": "Answer the following research question using the loaded corpus: $ARGUMENTS\n\nProcedure:\n1. Use list_papers() to confirm the corpus is loaded\n2. Use find_papers() and cite() helpers to locate relevant evidence\n3. If the corpus is large, use @rlm-subcall to extract from chunks\n4. Synthesise findings with explicit source attribution\n5. Flag any claims not supported by the corpus",
      "description": "Research query across the loaded PDF corpus",
      "agent": "research-write"
    },
    "write-section": {
      "template": "Write a LaTeX academic section on: $ARGUMENTS\n\nRequirements:\n1. Confirm corpus is loaded; list relevant papers with list_papers()\n2. Extract key claims and quotes using cite() or @rlm-subcall\n3. Draft the section in LaTeX with \\parencite{} or \\textcite{} commands\n4. Provide matching BibTeX entries for all cited works\n5. Flag any claims that lack corpus support",
      "description": "Draft a LaTeX section with BibTeX citations from the corpus",
      "agent": "research-write"
    },
    "cite-check": {
      "template": "Check all citations in the following LaTeX text against the loaded corpus. For each \\cite{} or \\parencite{} or \\textcite{} key:\n1. Confirm the paper exists in the loaded corpus\n2. Verify the claim attributed to it can be found in that paper\n3. Report: VERIFIED / NOT FOUND / UNVERIFIABLE for each\n\nText to check:\n$ARGUMENTS",
      "description": "Verify all citations exist and are accurate within the loaded corpus",
      "agent": "research-write"
    },
    "bibtex": {
      "template": "Generate BibTeX entries for the following papers from the loaded corpus: $ARGUMENTS\n\nFor each paper:\n1. Extract metadata (authors, year, title, journal, DOI) from the corpus text\n2. Generate a BibTeX key: firstauthorlastname + year + firstmeaningfulword\n3. Output a complete BibTeX entry\n4. Note any metadata fields that could not be determined from the corpus",
      "description": "Generate BibTeX entries from corpus paper metadata",
      "agent": "research-write"
    },
    "deep-dive": {
      "template": "Perform a deep analysis of the paper at: $ARGUMENTS\n\nUse the @paper-analyzer subagent to extract:\n1. Full bibliographic metadata\n2. Research question and objectives\n3. Theoretical framework\n4. Methodology\n5. Key findings (with direct quotes)\n6. Limitations\n7. References mentioned\n\nThen summarise the paper's contribution and relevance.",
      "description": "Deep single-paper analysis: metadata, methods, findings, references",
      "agent": "research-write",
      "subtask": true
    }
  },
  "instructions": [
    "AGENTS.md",
    "./knowledge/*.md"
  ]
}
